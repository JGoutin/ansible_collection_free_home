[Service]
# Fully unprivileged run
Type=exec
User=nginx
Group=nginx
CacheDirectory=nginx
CacheDirectoryMode=0750
LogsDirectory=nginx
LogsDirectoryMode=0750
RuntimeDirectory=nginx
RuntimeDirectoryMode=0750
StateDirectory=nginx
StateDirectoryMode=0750
AmbientCapabilities=CAP_NET_BIND_SERVICE
ExecStartPre=
PIDFile=
{% if nginx_inaccessible_paths is defined -%}InaccessiblePaths={{ nginx_inaccessible_paths }}{%- endif %}

# Restart on failure
Restart=on-failure
RestartSec=1

# Hardening
CapabilityBoundingSet=CAP_NET_BIND_SERVICE
LockPersonality=true
MemoryDenyWriteExecute=true
NoNewPrivileges=true
PrivateDevices=true
PrivateTmp=true
ProtectClock=true
ProtectControlGroups=true
ProtectHome=true
ProtectHostname=true
ProtectSystem=strict
ProtectKernelLogs=true
ProtectKernelModules=true
ProtectKernelTunables=true
RemoveIPC=true
RestrictAddressFamilies=AF_UNIX AF_INET AF_INET6
RestrictNamespaces=true
RestrictRealtime=true
RestrictSUIDSGID=true
SystemCallArchitectures=native
SystemCallErrorNumber=EPERM
SystemCallFilter=@system-service
UMask=0077
